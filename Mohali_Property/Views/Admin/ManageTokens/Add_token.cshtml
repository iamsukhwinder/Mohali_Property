@using Mohali_Property_Model
@model List<KothiModel>
<style>
    
    #add_token_form {
        margin-top: 30px;
        margin-left: 30px;
        margin-right: 30px;
    }

    #p1 {
        opacity: 1;
        color: red;
    }

    #div2 {
        background-color: lightgrey;
        color: white;
    }

</style>

<form  method="post" enctype="multipart/form-data" id="add_token_form" >

    <div id="div2">
        <h3>Generate Token</h3>

    </div>

    <p id="p1">* All Fields are Required</p>
    <div class="modal fade bd-example-modal-lg" id="KothiModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <h1>
                    Kothies  
                    &nbsp;&nbsp;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="color:green" fill="currentColor" class="bi bi-circle-fill" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" />
                    </svg><span style="font-size:1rem">&nbsp; Available </span>
                    &nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="color:yellow" fill="currentColor" class="bi bi-circle-fill" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" />
                    </svg><span style="font-size:1rem">&nbsp; Hold </span>
                    &nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="color:red" fill="currentColor" class="bi bi-circle-fill" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" />
                    </svg><span style="font-size:1rem">&nbsp; Not Available </span>
                </h1>
                <div class="d-flex justify-content-start">
                    @{
                        foreach (KothiModel kothi in Model)
                        {
                            if (kothi.hold == 1)
                            {
                                <button class="ms-3" type="button" onclick="select_kothi(@kothi.kothi_Number,@kothi.kothi_id)"><div class="p-2 bd-highlight bg-success">Kothi Number : @kothi.kothi_Number</div></button>

                            }
                            else if(kothi.hold == 2)
                            {
                                <button class="ms-3" type="button" onclick="select_kothi(@kothi.kothi_Number,@kothi.kothi_id)"> <div class="p-2 bd-highlight bg-warning">Kothi Number : @kothi.kothi_Number</div></button>

                            }
                            else
                            {
                                <button class="ms-3" type="button" onclick="select_kothi(@kothi.kothi_Number,@kothi.kothi_id)"><div class="p-2 bd-highlight bg-danger">Kothi Number : @kothi.kothi_Number</div></button>
                                
                            }


                        }
                    }

                </div>
            </div>
        </div>
    </div>
<div class="row">
    <div class="form-group col-md-6">
            <label>Select Kothi :</label>&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-primary btn-sm py-0 my-0" onclick="openplotmodal()">Show Plots</button>

            @*<input type="text" class="form-control" id="kothi" name="kothi_id"/> *@
            @*<select class="form-control" asp-items='(List<SelectListItem>)ViewData["kothiesDD"]' id="kothi" name="kothi_id"></select><br />*@
            <select class="form-control" id="kothi" name="kothi_id"></select>
        <span style="color:red" id="ekothi"></span>

    </div>
    <div class="form-group col-md-6">
        <label>Select Company :</label>
            <select class="form-control" asp-items='(List<SelectListItem>)ViewData["compnayDD"]' id="company" name="company_id"></select>
        <span style="color:red" id="ecompany"></span>
    </div>
   @* <div class="form-group col-md-4">
        <label>Select Associates :</label>
        <select name="status" id="status" class="form-control">
            <option selected>choose...</option>
            <option>Active</option>
            <option>InActive</option>

        </select>
        <span style="color:red" id="estatus"></span>
    </div>*@
    
</div><br />
<div class="row">

        <div class="form-group col-md-6">
            <label>Select Customer :</label>
            <select class="form-control" asp-items='(List<SelectListItem>)ViewData["customerDD"]' id="customer" name="customer_id"></select>
            <span style="color:red" id="ecustomer"></span>
        </div>
        <div class="form-group col-md-6">
            <label>Expiry Date And Time:</label>
            <input type="text" class="form-control" name="expiry_date" id="expiry_date" value='@TempData["expiry_token_date"] 11:59PM' readonly>
            <span style="color:red" id="eexpirydate"></span>
        </div>
    </div><br />
    
    <button type="button" class="btn btn-primary" onclick="return add_token()">Submit</button>
   </form>
   <script>
    
    function add_token(){
        var validate_result = validate();
        if(validate_result == false){
            return validate_result;
        }
        var data = new FormData();
        var form_data = $('#add_token_form').serializeArray();
        $.each(form_data, function (key, input) {
            data.append(input.name, input.value)
        });
        $.ajax({
            url: '/Token/AddToken',
            type: "post",
            dataType: 'json',
            processData: false,
            contentType: false,
            data: data,

            success: function (res) {
                if (res == 1) {

                    alert("Token created Successfully");

                }
                else{
                    alert("please try again later");
                }
                

            }

        });
    }

    function validate() {
        var result = true;
        var kothi = $("#kothi").find("option").val();
        if (kothi == undefined) {
            result = false;
            $("#ekothi").html("please select kothi");

        }
        else {
            $("#ekothi").html("");
        }

        var company = $("#company").val();
        if (company == "0") {
            result = false;
            $("#ecompany").html("please select company");

        }
        else {
            $("#ecompany").html("");
        }

        var customer = $("#customer").val();
        if (customer == "0") {
            result = false;
            $("#ecustomer").html("please select customer");

        }
        else {
            $("#ecusotmer").html("");
        }

        var expiry_date = $("#expiry_date").val();
        if (expiry_date == "") {
            result = false;
            $("#eexpirydate").html("expiry date can't be empty");

        }
        else {
            $("#eexpirydate").html("");
        }
        return result;

    }
   
    function openplotmodal(){
        $('#KothiModal').modal("show");
    }

    function select_kothi(kothi_number,id){
        $("#kothi").html("");
        $('#kothi').append(new Option(kothi_number, id))
        //$("#kothi").html(kothi_number);
        //$("#kothi").val(id);
        $('#KothiModal').modal("hide");
    }



   </script>